<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - YavlGold</title>
  <meta name="description" content="Panel de control del Ecosistema YavlGold">
  <meta name="theme-color" content="#0B0C0F">

  <!-- Favicon (YavlGold V9.2 Glow Logo) -->
  <link rel="icon" type="image/webp" href="/assets/images/logo.webp">
  <link rel="apple-touch-icon" href="/brand/logo.webp">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;600;700&display=swap"
    rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/assets/css/unificacion.css?v=9.2.1">
  <!-- External CSS commented out to force style update -->
  <!-- <link rel="stylesheet" href="/assets/css/dashboard.css?v=9.2.1"> -->

  <style>
    /* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ğŸ¨ YAVLGOLD DASHBOARD - PREMIUM DARK THEME
   Inherits from unificacion.css variables
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */

    /* â”â”â” ANIMATIONS â”â”â” */
    @keyframes breathe {

      0%,
      100% {
        transform: scale(1);
        filter: drop-shadow(0 0 20px rgba(200, 167, 82, 0.4));
      }

      50% {
        transform: scale(1.05);
        filter: drop-shadow(0 0 40px rgba(200, 167, 82, 0.7));
      }
    }

    @keyframes textGlow {

      0%,
      100% {
        text-shadow: 0 0 10px rgba(200, 167, 82, 0.5), 0 0 20px rgba(200, 167, 82, 0.3);
      }

      50% {
        text-shadow: 0 0 20px rgba(200, 167, 82, 0.8), 0 0 40px rgba(200, 167, 82, 0.5);
      }
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-15px);
      }
    }

    @keyframes cardGlow {

      0%,
      100% {
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(200, 167, 82, 0.1);
      }

      50% {
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 20px rgba(200, 167, 82, 0.15);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* â”â”â” BASE LAYOUT â”â”â” */
    .dashboard-page {
      min-height: 100vh;
      background: #0a0a0a !important;
      /* Aligned with index.html --bg-primary */
      position: relative;
      overflow-x: hidden;
    }

    /* Gradient overlay disabled for consistency with Herramientas
.dashboard-page::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    radial-gradient(ellipse at 20% 0%, rgba(200, 167, 82, 0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 100%, rgba(200, 167, 82, 0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}
*/

    .dashboard-main {
      position: relative;
      z-index: 1;
      padding-top: 100px;
      padding-bottom: 60px;
    }

    /* â”â”â” HERO SECTION â”â”â” */
    .dashboard-hero {
      text-align: center;
      padding: 60px 20px 80px;
      position: relative;
    }

    .dashboard-hero::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--color-secondary), transparent);
    }

    .hero-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--color-secondary), #9D8040);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--bg-darker);
      margin: 0 auto 24px;
      animation: breathe 4s ease-in-out infinite;
      border: 3px solid #D4AF37;
      /* Premium gold border */
      box-shadow: 0 0 25px rgba(212, 175, 55, 0.3);
      /* Elegant glow */
    }

    .hero-avatar img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .dashboard-hero h1 {
      font-family: 'Orbitron', sans-serif;
      /* Aligned with index.html */
      font-size: 3rem;
      font-weight: 900;
      color: #e5e5e5;
      /* Elegant off-white, not pure white */
      margin-bottom: 12px;
      animation: fadeInUp 0.6s ease-out;
    }

    .dashboard-hero h1 span {
      background: linear-gradient(135deg, #9D8040, var(--color-secondary), #E4D08E);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: textGlow 3s ease-in-out infinite;
    }

    .dashboard-hero p {
      font-family: 'Rajdhani', sans-serif;
      font-size: 1.2rem;
      color: var(--text-muted);
      font-weight: 500;
      animation: fadeInUp 0.6s ease-out 0.1s both;
    }

    /* â”â”â” MODULES GRID â”â”â” */
    .modules-section {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .modules-section h2 {
      font-family: 'Orbitron', sans-serif;
      /* Aligned with index.html */
      font-size: 1.8rem;
      font-weight: 900;
      color: var(--color-secondary);
      text-align: center;
      margin-bottom: 40px;
      position: relative;
    }

    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 28px;
    }

    /* â”â”â” MODULE CARDS - GLASSMORPHISM â”â”â” */
    .module-card {
      background: rgba(17, 17, 17, 0.85);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(200, 167, 82, 0.15);
      border-radius: 24px;
      /* Aligned with index.html feature-card */
      padding: 36px 28px;
      text-align: center;
      text-decoration: none;
      color: var(--text-primary);
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      animation: fadeInUp 0.6s ease-out both;
    }

    .module-card:nth-child(1) {
      animation-delay: 0.1s;
    }

    .module-card:nth-child(2) {
      animation-delay: 0.2s;
    }

    .module-card:nth-child(3) {
      animation-delay: 0.3s;
    }

    .module-card:nth-child(4) {
      animation-delay: 0.4s;
    }

    .module-card:nth-child(5) {
      animation-delay: 0.5s;
    }

    /* Card top accent line */
    .module-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--color-secondary), #E4D08E, var(--color-secondary));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease;
    }

    /* Card glow effect */
    .module-card::after {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 22px;
      background: linear-gradient(135deg, rgba(200, 167, 82, 0.3), transparent, rgba(200, 167, 82, 0.1));
      opacity: 0;
      z-index: -1;
      transition: opacity 0.4s ease;
    }

    .module-card:hover {
      transform: translateY(-12px) scale(1.02);
      border-color: rgba(200, 167, 82, 0.4);
      box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.5),
        0 0 40px rgba(200, 167, 82, 0.15);
    }

    .module-card:hover::before {
      transform: scaleX(1);
    }

    .module-card:hover::after {
      opacity: 1;
    }

    .module-card:hover .module-icon {
      transform: scale(1.15);
      filter: drop-shadow(0 0 20px rgba(200, 167, 82, 0.6));
    }

    /* Card Icon */
    .module-icon {
      font-size: 3.5rem;
      margin-bottom: 20px;
      display: block;
      transition: all 0.4s ease;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    }

    /* Card Title */
    .module-card h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--color-secondary);
      margin-bottom: 10px;
    }

    /* Card Description */
    .module-card p {
      font-family: 'Rajdhani', sans-serif;
      font-size: 1rem;
      color: var(--text-muted);
      margin-bottom: 20px;
      line-height: 1.5;
    }

    /* Card CTA Button */
    .module-cta {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 28px;
      background: linear-gradient(135deg, var(--color-secondary), #9D8040);
      color: var(--bg-darker);
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-radius: 50px;
      transition: all 0.3s ease;
    }

    .module-card:hover .module-cta {
      box-shadow: 0 6px 20px rgba(200, 167, 82, 0.4);
      transform: translateY(-2px);
    }

    /* â”â”â” DISABLED CARDS â”â”â” */
    .module-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .module-card.disabled::before,
    .module-card.disabled::after {
      display: none;
    }

    .module-card.disabled .module-icon {
      filter: grayscale(100%) brightness(0.7);
    }

    .module-card.disabled h3 {
      color: var(--text-muted);
    }

    .module-card.disabled .module-cta {
      background: rgba(100, 100, 100, 0.3);
      color: var(--text-muted);
    }

    .status-badge {
      display: inline-block;
      padding: 6px 14px;
      background: rgba(200, 167, 82, 0.1);
      border: 1px solid rgba(200, 167, 82, 0.3);
      border-radius: 20px;
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--color-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .module-card.disabled .status-badge {
      background: rgba(100, 100, 100, 0.2);
      border-color: rgba(100, 100, 100, 0.3);
      color: var(--text-muted);
    }

    /* â”â”â” DASHBOARD FOOTER â”â”â” */
    .dashboard-footer {
      text-align: center;
      padding: 40px 20px;
      margin-top: 60px;
      border-top: 1px solid rgba(200, 167, 82, 0.1);
    }

    .dashboard-footer p {
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .dashboard-footer a {
      color: var(--color-secondary);
      text-decoration: none;
      transition: opacity 0.3s;
    }

    .dashboard-footer a:hover {
      opacity: 0.8;
    }

    /* â”â”â” RESPONSIVE â”â”â” */
    @media (max-width: 768px) {
      .dashboard-main {
        padding-top: 80px;
      }

      .dashboard-hero {
        padding: 40px 20px 60px;
      }

      .hero-avatar {
        width: 80px;
        height: 80px;
        font-size: 2rem;
      }

      .dashboard-hero h1 {
        font-size: 2rem;
      }

      .dashboard-hero p {
        font-size: 1rem;
      }

      .modules-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .module-card {
        padding: 28px 20px;
      }

      .module-icon {
        font-size: 2.8rem;
      }

      .module-card h3 {
        font-size: 1.2rem;
      }
    }

    @media (max-width: 480px) {
      .dashboard-hero h1 {
        font-size: 1.6rem;
      }

      .modules-section h2 {
        font-size: 1.4rem;
      }
    }

    /* --- Logout Button Styles --- */
    #logout-btn-nav {
      background: var(--bg-darker);
      border: 1px solid var(--color-secondary);
      color: var(--color-secondary);
      padding: 8px 24px;
      border-radius: 50px;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-left: 20px;
      box-shadow: 0 0 10px rgba(200, 167, 82, 0.15);
    }

    #logout-btn-nav:hover {
      background: linear-gradient(135deg, var(--color-secondary), #9D8040);
      color: var(--bg-darker);
      box-shadow: 0 0 20px rgba(200, 167, 82, 0.5);
      transform: translateY(-2px);
    }

    /* --- Mobile Adjustments for Logout Button --- */
    @media (max-width: 991px) {
      #logout-btn-nav {
        display: inline-flex !important;
        /* Force visibility */
        margin-left: 0;
        /* Reset desktop margin */
        margin-top: 15px;
        /* Add spacing in mobile menu flow */
        width: auto;
        /* Allow it to size naturally or set to 100% if preferred */
        justify-content: center;
      }

      /* Ensure parent container doesn't hide it if necessary (adjust selector based on actual nav structure if needed) */
      .navbar-collapse.show #logout-btn-nav {
        display: flex !important;
      }
    }

    /* --- Mobile Floating Button Styles --- */
    .mobile-logout-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      /* Always on top */
      background: var(--bg-darker);
      border: 1px solid var(--color-secondary);
      color: var(--color-secondary);
      width: 45px;
      height: 45px;
      border-radius: 50%;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(200, 167, 82, 0.25);
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    .mobile-logout-btn:hover {
      background: linear-gradient(135deg, var(--color-secondary), #9D8040);
      color: var(--bg-darker);
      box-shadow: 0 0 20px rgba(200, 167, 82, 0.5);
    }

    @media (min-width: 992px) {
      .mobile-logout-btn {
        display: none !important;
      }

      /* Hide on Desktop */
    }
  </style>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="dashboard-page" data-page-protected="true">

  <!-- Header -->
  <header class="gg-header">
    <a class="brand" href="/">
      <img src="/brand/logo.webp" alt="YavlGold" class="logo" width="36" height="36">
      <span>YavlGold</span>
    </a>

    <nav class="main-nav">
      <a href="/">Inicio</a>
      <a href="/academia/">Academia</a>
      <a href="/suite/">Suite</a>
      <a href="/dashboard/" class="active">Dashboard</a>
      <button id="logout-btn-nav"
        class="nav-link btn-logout border border-[#D4AF37] text-[#D4AF37] hover:bg-[#D4AF37] hover:text-black transition-colors"
        style="cursor: pointer; display: none;">
        <i class="fas fa-sign-out-alt"></i> Cerrar SesiÃ³n
      </button>
    </nav>

    <!-- Auth Buttons (hidden when logged in) -->
    <div class="auth-buttons" id="auth-buttons" style="display: none;">
      <button class="btn-login" onclick="window.AuthUI?.showLoginModal()">
        <i class="fas fa-sign-in-alt"></i> Iniciar SesiÃ³n
      </button>
      <button class="btn-register" onclick="window.AuthUI?.showRegisterModal()">
        <i class="fas fa-user-plus"></i> Registrarse
      </button>
    </div>

    <!-- User Menu (shown when logged in) -->
    <div id="user-menu" class="user-menu" style="display: none;">
      <button id="user-menu-btn" class="user-menu-btn">
        <img src="" alt="" class="user-avatar-sm" id="user-avatar-img">
        <span id="user-menu-name">Usuario</span>
        <i class="fas fa-chevron-down"></i>
      </button>
      <div id="user-dropdown" class="user-dropdown" style="display: none;">
        <a href="/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        <a href="/dashboard/perfil"><i class="fas fa-user"></i> Mi Perfil</a>
        <a href="/dashboard/configuracion"><i class="fas fa-cog"></i> ConfiguraciÃ³n</a>
        <hr>
        <button id="dropdown-logout-btn" class="logout-btn">
          <i class="fas fa-sign-out-alt"></i> Cerrar SesiÃ³n
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">

    <!-- Hero Section -->
    <section class="dashboard-hero">
      <div class="hero-avatar" id="hero-avatar">
        <span id="hero-avatar-initials">YG</span>
      </div>
      <h1 class="welcome-title"
        style="background: linear-gradient(to right, #D4AF37, #FDB931, #D4AF37); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent;">
        Bienvenido, <span id="user-name-display"
          style="background: inherit; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent;">Usuario</span>
      </h1>
      <p>Tu centro de control del Ecosistema YavlGold</p>
    </section>

    <!-- Modules Grid -->
    <section class="modules-section">
      <h2>Explora el Ecosistema</h2>

      <div class="modules-grid">

        <!-- Academia Module -->
        <a href="/academia/" class="module-card">
          <span class="module-icon">ğŸ“</span>
          <h3>Academia YavlGold</h3>
          <p>EducaciÃ³n financiera premium. Aprende trading, criptomonedas y mÃ¡s.</p>
          <span class="module-cta">Entrar <i class="fas fa-arrow-right"></i></span>
        </a>

        <!-- Suite Multimedia Module -->
        <a href="/suite/" class="module-card">
          <span class="module-icon">ğŸ¬</span>
          <h3>Suite Multimedia</h3>
          <p>Herramientas creativas para producciÃ³n de contenido audiovisual.</p>
          <span class="module-cta">Entrar <i class="fas fa-arrow-right"></i></span>
        </a>

        <!-- Herramientas Module -->
        <a href="/herramientas/" class="module-card">
          <span class="module-icon">ğŸ§©</span>
          <h3>Herramientas</h3>
          <p>Utilidades prÃ¡cticas para tu dÃ­a a dÃ­a: conversor, calculadora y mÃ¡s.</p>
          <span class="module-cta">Entrar <i class="fas fa-arrow-right"></i></span>
        </a>

        <!-- Trading Module (Coming Soon) -->
        <div class="module-card disabled">
          <span class="module-icon">ğŸ“ˆ</span>
          <h3>Trading Pro</h3>
          <p>AnÃ¡lisis de mercados, seÃ±ales y herramientas avanzadas de trading.</p>
          <span class="status-badge">PrÃ³ximamente</span>
        </div>

        <!-- Agro Module -->
        <a href="/agro" class="module-card">
          <span class="module-icon">ğŸŒ±</span>
          <h3>Agro</h3>
          <!-- Link fix forced -->
          <p>Agricultura inteligente y tecnologÃ­a aplicada al campo.</p>
          <span class="module-cta">Entrar <i class="fas fa-arrow-right"></i></span>
        </a>

        <!-- Social Module -->
        <a href="/social" class="module-card">
          <span class="module-icon"><i class="fas fa-users" style="font-size: 2rem; color: #D4AF37;"></i></span>
          <h3>Social</h3>
          <p>Conecta con la comunidad, comparte ideas y crece en el ecosistema.</p>
          <span class="module-cta">Entrar <i class="fas fa-arrow-right"></i></span>
        </a>

      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="dashboard-footer">
    <p>YavlGold Version 9.2.1 (Patch UI) Â© 2025 â€” <a href="/">Volver al Inicio</a></p>
  </footer>

  <!-- Scripts -->
  <!-- Auth Guard & Main Logic -->
  <script type="module" src="../assets/js/main.js"></script>

  <!-- Dashboard UI Logic -->
  <script type="module">
    // Import directly to guarantee execution order
    import { supabase } from '../assets/js/main.js';

    async function initDashboard() {
      console.log('[Dashboard] Verificando sesiÃ³n...');

      // 1. Get Session safely
      const { data: { session }, error } = await supabase.auth.getSession();

      if (error || !session) {
        console.warn('[Dashboard] Sin sesiÃ³n. Redirigiendo...');
        window.location.href = '/';
        return;
      }

      // 2. Update UI
      console.log('[Dashboard] SesiÃ³n activa:', session.user.email);
      const user = session.user;
      const emailName = user.email.split('@')[0];
      const nameDisplay = document.getElementById('user-name-display');
      if (nameDisplay) nameDisplay.textContent = emailName;

      // 3. Activate Logout Buttons (Nav & Mobile)
      const logoutButtons = document.querySelectorAll('#logout-btn-nav, #dropdown-logout-btn, .btn-logout');

      logoutButtons.forEach(btn => {
        btn.style.display = 'inline-flex'; // Force visibility
        btn.onclick = async (e) => {
          e.preventDefault();
          await supabase.auth.signOut();
          window.location.href = '/';
        };
      });
    }

    initDashboard();
  </script>

  <button id="mobile-logout-fab" class="mobile-logout-btn" style="display: none;">
    <i class="fas fa-sign-out-alt"></i>
  </button>

  <script>
    // Mobile FAB Logic (Fixed Loop)
    const fab = document.getElementById('mobile-logout-fab');

    // 1. Visibility Check
    if (window.innerWidth <= 991) {
      fab.style.display = 'flex';
    }

    // 2. Click Handler
    fab.addEventListener('click', async () => {
      try {
        fab.style.opacity = '0.5';

        // Try graceful logout first
        const module = await import('../assets/js/main.js');
        const supabase = module.supabase;
        if (!supabase) throw new Error("Supabase client not found");

        await supabase.auth.signOut();
        // Clear storage just in case
        localStorage.clear();
        window.location.href = '/';

      } catch (err) {
        console.error('Logout failed, forcing local cleanup:', err);

        // --- NUCLEAR OPTION (Prevent Redirect Loop) ---
        // Manually clear all Supabase tokens/data
        localStorage.clear();
        sessionStorage.clear();

        // Optional: Clear specific cookies if accessible via JS (usually httpOnly, but good practice to try)
        document.cookie.split(";").forEach(function (c) {
          document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
        });

        alert('SesiÃ³n cerrada (Modo Local).');
        window.location.href = '/';
      }
    });
  </script>

</body>

</html>
