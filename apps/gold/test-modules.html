<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test de M√≥dulos - YavlGold</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #0B0C0F;
      color: #E5E7EB;
    }
    .test-section {
      background: #1a1b1f;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border-left: 4px solid #C8A752;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 10px;
    }
    .success { background: #10b981; color: white; }
    .error { background: #ef4444; color: white; }
    .pending { background: #f59e0b; color: white; }
    pre {
      background: #000;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    button {
      background: linear-gradient(135deg, #C8A752, #D4AF37);
      color: #0B0C0F;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(200, 167, 82, 0.3);
    }
  </style>
</head>
<body>
  <h1>üß™ Test de M√≥dulos YavlGold</h1>
  
  <div class="test-section">
    <h2>1. Carga de Supabase JS <span id="status-supabase" class="status pending">‚è≥ Pending</span></h2>
    <pre id="result-supabase">Cargando...</pre>
  </div>

  <div class="test-section">
    <h2>2. M√≥dulo auth.js <span id="status-auth" class="status pending">‚è≥ Pending</span></h2>
    <pre id="result-auth">Cargando...</pre>
  </div>

  <div class="test-section">
    <h2>3. AuthClient disponible <span id="status-client" class="status pending">‚è≥ Pending</span></h2>
    <pre id="result-client">Esperando...</pre>
  </div>

  <div class="test-section">
    <h2>4. AuthGuard disponible <span id="status-guard" class="status pending">‚è≥ Pending</span></h2>
    <pre id="result-guard">Esperando...</pre>
  </div>

  <div class="test-section">
    <h2>5. AuthUI disponible <span id="status-ui" class="status pending">‚è≥ Pending</span></h2>
    <pre id="result-ui">Esperando...</pre>
  </div>

  <div class="test-section">
    <h2>6. Test de Modal</h2>
    <button onclick="testAuthModal()">Abrir Modal de Login</button>
    <button onclick="testRegisterModal()">Abrir Modal de Registro</button>
    <pre id="result-modal">Haz clic en los botones para probar</pre>
  </div>

  <div class="test-section">
    <h2>7. Script.js cargado <span id="status-script" class="status pending">‚è≥ Pending</span></h2>
    <pre id="result-script">Verificando...</pre>
  </div>

  <!-- Cargar Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Cargar sistema de auth -->
  <script type="module" src="/apps/gold/assets/js/auth.js"></script>
  <script src="/apps/gold/assets/js/script.js"></script>

  <script>
    // Test 1: Supabase
    setTimeout(() => {
      const supabaseOk = typeof window.supabase !== 'undefined';
      document.getElementById('status-supabase').className = 'status ' + (supabaseOk ? 'success' : 'error');
      document.getElementById('status-supabase').textContent = supabaseOk ? '‚úÖ OK' : '‚ùå Error';
      document.getElementById('result-supabase').textContent = supabaseOk 
        ? 'window.supabase est√° disponible\nVersi√≥n: ' + (window.supabase.createClient ? 'v2' : 'desconocida')
        : 'ERROR: window.supabase no est√° definido';
    }, 100);

    // Test 2: auth.js
    setTimeout(() => {
      const authOk = typeof window.AuthClient !== 'undefined';
      document.getElementById('status-auth').className = 'status ' + (authOk ? 'success' : 'error');
      document.getElementById('status-auth').textContent = authOk ? '‚úÖ OK' : '‚ùå Error';
      document.getElementById('result-auth').textContent = authOk
        ? 'auth.js cargado correctamente'
        : 'ERROR: auth.js no se carg√≥';
    }, 500);

    // Test 3: AuthClient
    setTimeout(() => {
      const clientOk = typeof window.AuthClient !== 'undefined' && window.AuthClient.supabase !== null;
      document.getElementById('status-client').className = 'status ' + (clientOk ? 'success' : 'error');
      document.getElementById('status-client').textContent = clientOk ? '‚úÖ OK' : '‚ùå Error';
      document.getElementById('result-client').textContent = clientOk
        ? 'AuthClient inicializado:\n' + JSON.stringify({
            hasSupabase: !!window.AuthClient.supabase,
            hasSession: !!window.AuthClient.currentSession,
            methods: Object.keys(window.AuthClient).filter(k => typeof window.AuthClient[k] === 'function').slice(0, 5).join(', ')
          }, null, 2)
        : 'ERROR: AuthClient no inicializado';
    }, 1000);

    // Test 4: AuthGuard
    setTimeout(() => {
      const guardOk = typeof window.AuthGuard !== 'undefined';
      document.getElementById('status-guard').className = 'status ' + (guardOk ? 'success' : 'error');
      document.getElementById('status-guard').textContent = guardOk ? '‚úÖ OK' : '‚ùå Error';
      document.getElementById('result-guard').textContent = guardOk
        ? 'AuthGuard disponible:\n' + JSON.stringify({
            initialized: !!window.AuthGuard,
            methods: Object.keys(window.AuthGuard).filter(k => typeof window.AuthGuard[k] === 'function').slice(0, 5).join(', ')
          }, null, 2)
        : 'ERROR: AuthGuard no disponible';
    }, 1000);

    // Test 5: AuthUI
    setTimeout(() => {
      const uiOk = typeof window.AuthUI !== 'undefined';
      document.getElementById('status-ui').className = 'status ' + (uiOk ? 'success' : 'error');
      document.getElementById('status-ui').textContent = uiOk ? '‚úÖ OK' : '‚ùå Error';
      document.getElementById('result-ui').textContent = uiOk
        ? 'AuthUI disponible:\n' + JSON.stringify({
            initialized: !!window.AuthUI,
            hasElements: !!window.AuthUI.elements,
            methods: Object.keys(window.AuthUI).filter(k => typeof window.AuthUI[k] === 'function').slice(0, 5).join(', ')
          }, null, 2)
        : 'ERROR: AuthUI no disponible';
    }, 1000);

    // Test 7: Script.js
    setTimeout(() => {
      const scriptOk = true; // Si llegamos aqu√≠, script.js carg√≥
      document.getElementById('status-script').className = 'status success';
      document.getElementById('status-script').textContent = '‚úÖ OK';
      document.getElementById('result-script').textContent = 'script.js cargado correctamente';
    }, 500);

    // Test 6: Modal functions
    function testAuthModal() {
      const result = document.getElementById('result-modal');
      if (typeof window.AuthUI !== 'undefined' && typeof window.AuthUI.switchTab === 'function') {
        try {
          window.AuthUI.switchTab('login');
          result.textContent = '‚úÖ Modal de login deber√≠a estar visible';
        } catch (e) {
          result.textContent = '‚ùå Error al abrir modal: ' + e.message;
        }
      } else {
        result.textContent = '‚ùå AuthUI.switchTab no est√° disponible';
      }
    }

    function testRegisterModal() {
      const result = document.getElementById('result-modal');
      if (typeof window.AuthUI !== 'undefined' && typeof window.AuthUI.switchTab === 'function') {
        try {
          window.AuthUI.switchTab('register');
          result.textContent = '‚úÖ Modal de registro deber√≠a estar visible';
        } catch (e) {
          result.textContent = '‚ùå Error al abrir modal: ' + e.message;
        }
      } else {
        result.textContent = '‚ùå AuthUI.switchTab no est√° disponible';
      }
    }

    // Capturar errores de consola
    window.addEventListener('error', (e) => {
      console.error('Error capturado:', e.message, e.filename, e.lineno);
    });

    // Mostrar todos los logs de auth
    console.log('=== TEST DE M√ìDULOS INICIADO ===');
  </script>
</body>
</html>
