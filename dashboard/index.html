<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - YavlGold</title>
  <meta name="description" content="Panel de control de YavlGold">
  
  <!-- Metadatos Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yavlgold.com/dashboard/">
  <meta property="og:title" content="Dashboard - YavlGold">
  <meta property="og:description" content="Panel de control de YavlGold">
  <meta property="og:image" content="https://yavlgold.com/assets/brand/og-cover.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://yavlgold.com/dashboard/">
  <meta property="twitter:title" content="Dashboard - YavlGold">
  <meta property="twitter:description" content="Panel de control de YavlGold">
  <meta property="twitter:image" content="https://yavlgold.com/assets/brand/og-cover.png">
  
  <!-- Favicon -->
  <link rel="icon" href="../assets/images/logo.png" type="image/png">
  <link rel="alternate icon" href="../assets/images/logo.png" sizes="32x32">
  <link rel="apple-touch-icon" href="../assets/images/logo.png">
  <meta name="theme-color" content="#0B0C0F">

  <!-- Cache busting (one-time) to avoid stale HTML in some browsers/CDNs -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script>
    (function () {
      try {
        var BUST_VERSION = '20250929';
        var key = 'gg_html_busted_dashboard';
        var url = new URL(window.location.href);
        var already = sessionStorage.getItem(key);
        if (!url.searchParams.has('v') && !already) {
          url.searchParams.set('v', BUST_VERSION);
          sessionStorage.setItem(key, '1');
          window.location.replace(url.toString());
        }
      } catch (e) { /* ignore */ }
    })();
  </script>
  
  <!-- Estilos y fuentes: hoja unificada + iconos + fuentes -->
  <link rel="stylesheet" href="../assets/css/unificacion.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Supabase Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Protección de acceso - Ejecutar antes de mostrar contenido -->
  <script>
    (function() {
      // Verificar si hay sesión de Supabase
      function checkSupabaseSession() {
        try {
          // Buscar en localStorage todas las claves que contienen 'auth-token'
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.includes('auth-token')) {
              const item = localStorage.getItem(key);
              if (item) {
                const parsed = JSON.parse(item);
                if (parsed.access_token || parsed.user) {
                  console.log('[Dashboard] ✅ Sesión encontrada');
                  return true;
                }
              }
            }
          }
          return false;
        } catch (e) {
          console.error('[Dashboard] Error verificando sesión:', e);
          return false;
        }
      }

      if (!checkSupabaseSession()) {
        console.log('[Dashboard] ⛔ No hay sesión, redirigiendo...');
        sessionStorage.setItem('gg:redirectAfterLogin', window.location.pathname);
        window.location.replace('../#login');
      } else {
        console.log('[Dashboard] ✅ Sesión válida, permitiendo acceso');
      }
    })();
  </script>
  
  <style>
    /* Estilos específicos del dashboard (manteniendo layout propio) */
    body {
      background: var(--bg-darker);
      color: var(--text-light);
      line-height: 1.7;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed; inset: 0;
      background:
        radial-gradient(circle at 20% 80%, rgba(200,167,82,.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(200,167,82,.05) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(17,17,17,.1) 0%, transparent 50%);
      z-index: -1;
    }
    .dashboard-container { display: flex; min-height: 100vh; padding-top: 80px; }
    .sidebar { width: 280px; background: var(--card-bg); padding: 30px 20px; border-right: 1px solid rgba(255,255,255,0.1); }
    .user-info { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .user-avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--gradient-gold); display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; margin: 0 auto 15px; color: var(--bg-darker); }
    .sidebar-nav { display: flex; flex-direction: column; gap: 10px; }
    .nav-item { padding: 15px; text-decoration: none; color: var(--text-light); border-radius: 8px; transition: var(--transition); display: flex; align-items: center; gap: 10px; }
    .nav-item:hover, .nav-item.active { background: rgba(200, 167, 82, 0.1); color: var(--color-secondary); }
    .main-content { flex: 1; padding: 30px; overflow-y: auto; }
    .content-section { display: none; }
    .content-section.active { display: block; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: var(--card-bg); padding: 25px; border-radius: var(--border-radius); border: 1px solid rgba(255,255,255,0.1); text-align: center; }
    .stat-value { font-size: 2rem; font-weight: bold; color: var(--color-secondary); margin: 10px 0; }
    .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
    .action-card { background: var(--card-bg); padding: 25px; border-radius: var(--border-radius); text-align: center; text-decoration: none; color: var(--text-light); transition: var(--transition); border: 1px solid rgba(255,255,255,0.1); position: relative; }
    .action-card:hover { transform: translateY(-5px); border-color: var(--color-secondary); }
    .action-icon { font-size: 2.5rem; color: var(--color-secondary); margin-bottom: 15px; }
    
    /* Ecosystem Cards */
    .ecosystem-section { margin-top: 40px; }
    .ecosystem-card { 
      position: relative;
      overflow: hidden;
    }
    .ecosystem-card.priority-1 {
      border: 2px solid var(--color-secondary);
      background: linear-gradient(135deg, rgba(200, 167, 82, 0.1), var(--card-bg));
    }
    .ecosystem-card.priority-2 {
      border: 2px solid rgba(200, 167, 82, 0.6);
      background: linear-gradient(135deg, rgba(200, 167, 82, 0.05), var(--card-bg));
    }
    .ecosystem-card.coming-soon {
      opacity: 0.7;
      cursor: not-allowed;
    }
    .priority-badge,
    .coming-soon-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .priority-badge {
      background: var(--gradient-gold);
      color: var(--bg-darker);
    }
    .coming-soon-badge {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-muted);
    }
    .ecosystem-card h4 {
      font-size: 1.1rem;
      margin: 10px 0 5px;
      font-weight: 600;
    }
    .ecosystem-card p {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin: 0;
    }
    
    /* Anuncios */
    .announcements-section { margin: 40px 0; }
    .announcements-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .announcements-header h3 { margin: 0; display: flex; align-items: center; gap: 10px; }
    .announcements-list { display: flex; flex-direction: column; gap: 20px; }
    .announcement-card { background: var(--card-bg); padding: 25px; border-radius: var(--border-radius); border: 1px solid rgba(255,255,255,0.1); transition: var(--transition); position: relative; }
    .announcement-card:hover { border-color: var(--color-secondary); transform: translateY(-3px); }
    .announcement-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
    .announcement-title { font-size: 1.3rem; font-weight: 600; color: var(--color-secondary); margin: 0 0 10px; }
    .announcement-meta { display: flex; align-items: center; gap: 15px; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px; }
    .announcement-author { display: flex; align-items: center; gap: 8px; }
    .announcement-author-avatar { width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--color-secondary); }
    .announcement-content { color: var(--text-light); line-height: 1.7; white-space: pre-wrap; }
    .announcement-date { display: flex; align-items: center; gap: 5px; }
    .announcement-actions { position: absolute; top: 25px; right: 25px; display: flex; gap: 10px; }
    .announcement-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 8px 12px; border-radius: 6px; transition: var(--transition); }
    .announcement-btn:hover { background: rgba(255,255,255,0.1); color: var(--color-secondary); }
    .admin-badge { background: var(--gradient-gold); color: var(--bg-darker); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
    .create-announcement-btn { background: var(--gradient-gold); color: var(--bg-darker); padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: var(--transition); }
    .create-announcement-btn:hover { opacity: 0.9; transform: translateY(-2px); }
    .no-announcements { text-align: center; padding: 40px 20px; color: var(--text-muted); }
    .announcement-form-modal { max-width: 600px; }
    .form-group textarea { min-height: 150px; resize: vertical; }
    .loading-spinner { text-align: center; padding: 40px; color: var(--color-secondary); }
    .load-more-btn { width: 100%; padding: 15px; background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); color: var(--text-light); border-radius: 8px; cursor: pointer; font-weight: 600; transition: var(--transition); margin-top: 20px; }
    .load-more-btn:hover { border-color: var(--color-secondary); background: rgba(200, 167, 82, 0.1); }
    .login-prompt { text-align: center; padding: 60px 20px; max-width: 500px; margin: 100px auto; background: var(--card-bg); border-radius: var(--border-radius); border: 1px solid rgba(255,255,255,0.1); }
    
    /* Modal de autenticación */
    #modal-overlay {
      display: none;
      position: fixed;
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 9999;
      backdrop-filter: blur(5px);
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 50%; 
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 500px;
      z-index: 10000;
      background: var(--card-bg-solid);
      border-radius: 20px;
      padding: 30px;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      backdrop-filter: blur(20px);
    }
    
    .modal-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-logo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--color-secondary);
      margin-bottom: 15px;
    }
    
    .modal-header h2 { 
      margin: 0; 
      color: transparent;
      background: var(--gradient-gold);
      -webkit-background-clip: text;
      background-clip: text;
      font-family: 'Playfair Display', serif;
      text-align: center;
    }
    
    .close-modal-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 1.8rem;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: var(--transition);
    }
    
    .close-modal-btn:hover {
      background: rgba(255,255,255,0.1);
      color: var(--color-secondary);
      transform: scale(1.1);
    }
    
    .auth-tabs {
      display: flex;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 25px;
    }
    
    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 15px 0;
      cursor: pointer;
      font-weight: 600;
      color: var(--text-muted);
      transition: var(--transition);
      border-bottom: 3px solid transparent;
    }
    
    .auth-tab.active {
      color: var(--color-secondary);
      border-bottom-color: var(--color-secondary);
    }
    
    .auth-form { 
      display: none; 
    }
    
    .auth-form.active { 
      display: block; 
    }
    
    .form-group { 
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--color-secondary);
      font-family: 'Montserrat', sans-serif;
    }
    
    input, select, textarea {
      padding: 14px;
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: white;
      font-size: 16px;
      transition: var(--transition);
      font-family: 'Montserrat', sans-serif;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--color-secondary);
      box-shadow: 0 0 0 2px rgba(200, 167, 82, 0.2);
      background: rgba(255, 255, 255, 0.08);
    }
    
    .password-container { 
      position: relative; 
      display: flex;
      align-items: center;
    }
    
    .password-container input {
      padding-right: 50px;
      width: 100%;
      margin: 0;
    }
    
    .toggle-password {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 8px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      transition: var(--transition);
    }
    
    .toggle-password:hover {
      background: rgba(255,255,255,0.1);
      color: var(--color-secondary);
    }
    
    /* Notificaciones */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      z-index: 2000;
      animation: slideIn 0.5s ease-out;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 400px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .notification-success { background: var(--success-color); }
    .notification-error { background: var(--error-color); }
    .notification-warning { background: var(--warning-color); }
    .notification-info { background: var(--color-primary); }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    /* User Menu & Auth Buttons */
    .auth-buttons {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .btn-login, .btn-register {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Montserrat', sans-serif;
    }
    
    .btn-login {
      background: transparent;
      color: var(--color-secondary);
      border: 2px solid var(--color-secondary);
    }
    
    .btn-login:hover {
      background: var(--color-secondary);
      color: var(--bg-darker);
    }
    
    .btn-register {
      background: var(--gradient-gold);
      color: var(--bg-darker);
    }
    
    .btn-register:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(200, 167, 82, 0.4);
    }
    
    .user-menu {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .user-menu-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      background: rgba(200, 167, 82, 0.1);
      border: 1px solid var(--color-secondary);
      border-radius: 8px;
      color: var(--text-light);
      cursor: pointer;
      transition: var(--transition);
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
    }
    
    .user-menu-btn:hover {
      background: rgba(200, 167, 82, 0.2);
    }
    
    .user-avatar-sm {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .user-dropdown {
      position: absolute;
      top: calc(100% + 10px);
      right: 0;
      background: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 10px;
      min-width: 220px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      z-index: 1000;
    }
    
    .user-dropdown a,
    .user-dropdown button {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: var(--text-light);
      text-decoration: none;
      border-radius: 8px;
      transition: var(--transition);
      width: 100%;
      text-align: left;
      background: transparent;
      border: none;
      cursor: pointer;
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
    }
    
    .user-dropdown a:hover,
    .user-dropdown button:hover {
      background: rgba(200, 167, 82, 0.1);
      color: var(--color-secondary);
    }
    
    .user-dropdown hr {
      margin: 8px 0;
      border: none;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .logout-btn {
      color: #ff6b6b !important;
    }
    
    .logout-btn:hover {
      background: rgba(255, 107, 107, 0.1) !important;
    }

    @media (max-width: 768px) {
      .dashboard-container { flex-direction: column; }
      .sidebar { width: 100%; order: 2; }
      .main-content { order: 1; }
      .sidebar-nav { flex-direction: row; overflow-x: auto; }
      .nav-item { white-space: nowrap; }
      
      .auth-buttons {
        gap: 8px;
      }
      
      .btn-login, .btn-register {
        padding: 8px 12px;
        font-size: 14px;
      }
      
      .user-menu-btn span {
        display: none;
      }
    }
    
    /* ============================================
       ESTILOS DE ACADEMIA - PROGRESO ACADÉMICO
       ============================================ */
    .academia-section {
      background: linear-gradient(135deg, rgba(200, 167, 82, 0.05), transparent);
      border: 2px solid rgba(200, 167, 82, 0.3);
      border-radius: 16px;
      padding: 30px;
      margin: 40px 0;
    }
    
    .academia-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .academia-header h3 {
      margin: 0;
      font-size: 1.8rem;
      color: var(--color-secondary);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .view-all-link {
      color: var(--color-secondary);
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .view-all-link:hover {
      opacity: 0.8;
      transform: translateX(5px);
    }
    
    /* Stats Cards de Academia */
    .academia-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .academia-stat-card {
      background: var(--card-bg);
      border: 1px solid rgba(200, 167, 82, 0.2);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    .academia-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-gold);
    }
    
    .academia-stat-card:hover {
      transform: translateY(-5px);
      border-color: var(--color-secondary);
      box-shadow: 0 8px 24px rgba(200, 167, 82, 0.2);
    }
    
    .stat-icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--color-secondary);
      margin-bottom: 5px;
    }
    
    .stat-sublabel {
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    
    /* XP Progress Bar */
    .xp-progress-container {
      margin-bottom: 30px;
    }
    
    .xp-progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .current-level {
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .level-icon {
      font-size: 1.5rem;
    }
    
    .xp-text {
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    
    .progress-bar-wrapper {
      background: rgba(255, 255, 255, 0.1);
      height: 30px;
      border-radius: 15px;
      overflow: hidden;
      position: relative;
    }
    
    .progress-bar-fill {
      height: 100%;
      background: var(--gradient-gold);
      transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--bg-darker);
    }
    
    /* Cursos en Progreso */
    .courses-progress {
      margin-bottom: 30px;
    }
    
    .courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }
    
    .course-card {
      background: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      transition: var(--transition);
      cursor: pointer;
    }
    
    .course-card:hover {
      border-color: var(--color-secondary);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(200, 167, 82, 0.15);
    }
    
    .course-header {
      display: flex;
      align-items: start;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .course-icon {
      font-size: 2rem;
      flex-shrink: 0;
    }
    
    .course-info h4 {
      margin: 0 0 5px;
      color: var(--color-secondary);
      font-size: 1.1rem;
    }
    
    .course-meta {
      font-size: 0.85rem;
      color: var(--text-muted);
      display: flex;
      gap: 15px;
    }
    
    .course-progress-bar {
      background: rgba(255, 255, 255, 0.1);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    
    .course-progress-fill {
      height: 100%;
      background: var(--gradient-gold);
      transition: width 0.6s ease;
    }
    
    .course-progress-text {
      font-size: 0.85rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
    }
    
    /* Badges Recientes */
    .badges-section {
      margin-bottom: 30px;
    }
    
    .badges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .badge-card {
      background: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: var(--transition);
      position: relative;
    }
    
    .badge-card.new-badge::after {
      content: 'NUEVO';
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff6b6b;
      color: white;
      font-size: 0.65rem;
      padding: 3px 8px;
      border-radius: 10px;
      font-weight: 700;
    }
    
    .badge-card:hover {
      transform: scale(1.05);
      border-color: var(--color-secondary);
    }
    
    .badge-icon {
      font-size: 3rem;
      margin-bottom: 10px;
      filter: drop-shadow(0 4px 8px rgba(200, 167, 82, 0.3));
    }
    
    .badge-rarity {
      display: inline-block;
      font-size: 0.7rem;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .badge-rarity.common { background: #4CAF50; color: white; }
    .badge-rarity.rare { background: #2196F3; color: white; }
    .badge-rarity.epic { background: #9C27B0; color: white; }
    .badge-rarity.legendary { background: #FF9800; color: white; }
    
    .badge-card h5 {
      margin: 8px 0 5px;
      font-size: 0.95rem;
    }
    
    .badge-card p {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin: 0;
    }
    
    /* Próxima Lección */
    .next-lesson-card {
      background: linear-gradient(135deg, rgba(200, 167, 82, 0.1), var(--card-bg));
      border: 2px solid var(--color-secondary);
      border-radius: 16px;
      padding: 30px;
      display: flex;
      align-items: center;
      gap: 25px;
      transition: var(--transition);
    }
    
    .next-lesson-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 32px rgba(200, 167, 82, 0.3);
    }
    
    .next-lesson-icon {
      font-size: 4rem;
      color: var(--color-secondary);
      flex-shrink: 0;
    }
    
    .next-lesson-content {
      flex: 1;
    }
    
    .next-lesson-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    
    .next-lesson-content h4 {
      margin: 0 0 8px;
      font-size: 1.5rem;
      color: var(--color-secondary);
    }
    
    .next-lesson-meta {
      display: flex;
      gap: 20px;
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 15px;
    }
    
    .btn-start-lesson {
      background: var(--gradient-gold);
      color: var(--bg-darker);
      padding: 12px 30px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: var(--transition);
    }
    
    .btn-start-lesson:hover {
      transform: translateX(5px);
      box-shadow: 0 6px 20px rgba(200, 167, 82, 0.4);
    }
    
    /* Empty States */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
    }
    
    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .empty-state h4 {
      margin-bottom: 10px;
      color: var(--text-light);
    }
    
    .empty-state a {
      color: var(--color-secondary);
      text-decoration: none;
      font-weight: 600;
    }
    
    .empty-state a:hover {
      text-decoration: underline;
    }
    
    @media (max-width: 768px) {
      .academia-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .courses-grid {
        grid-template-columns: 1fr;
      }
      
      .badges-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .next-lesson-card {
        flex-direction: column;
        text-align: center;
      }
      
      .academia-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
    }
    
    /* CoinGecko Widget */
    .crypto-widget {
      margin-top: 30px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(200, 167, 82, 0.05), var(--card-bg));
      border: 1px solid rgba(200, 167, 82, 0.3);
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(200, 167, 82, 0.2);
    }
    
    .crypto-widget-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(200, 167, 82, 0.2);
    }
    
    .crypto-widget-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--color-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .crypto-refresh-btn {
      background: transparent;
      border: 1px solid rgba(200, 167, 82, 0.3);
      color: var(--color-secondary);
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.85rem;
    }
    
    .crypto-refresh-btn:hover {
      background: rgba(200, 167, 82, 0.1);
      border-color: var(--color-secondary);
    }
    
    .crypto-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .crypto-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: rgba(11, 12, 15, 0.4);
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    
    .crypto-item:hover {
      background: rgba(200, 167, 82, 0.08);
      transform: translateX(3px);
    }
    
    .crypto-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }
    
    .crypto-logo {
      width: 28px;
      height: 28px;
      border-radius: 50%;
    }
    
    .crypto-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-light);
    }
    
    .crypto-symbol {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }
    
    .crypto-price {
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--text-light);
      text-align: right;
    }
    
    .crypto-change {
      font-size: 0.85rem;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      text-align: right;
    }
    
    .crypto-change.positive {
      color: #2ecc71;
      background: rgba(46, 204, 113, 0.1);
    }
    
    .crypto-change.negative {
      color: #e74c3c;
      background: rgba(231, 76, 60, 0.1);
    }
    
    .crypto-loading {
      text-align: center;
      padding: 30px;
      color: var(--text-muted);
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .crypto-loading i {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body>
  <!-- Header con navegación -->
  <header class="gg-header">
    <a class="brand" href="../">
  <img src="/assets/images/logo.png" alt="YavlGold" class="logo">
  <span>YavlGold</span>
    </a>
    
    <nav class="main-nav">
      <a href="../herramientas/" data-protected="true">Herramientas</a>
      <a href="../academia/">Academia</a>
      <a href="../#comunidad">Comunidad</a>
      <a href="./" class="active">Dashboard</a>
      <a href="../#contacto">Contacto</a>
    </nav>
    
    <div class="auth-buttons" id="auth-buttons" style="display: flex; gap: 12px;">
      <!-- Theme Toggle Button -->
      <button id="theme-toggle" title="Cambiar tema" aria-label="Cambiar tema">
        <i class="fas fa-moon"></i>
      </button>
      <button class="btn-login" onclick="window.AuthUI?.showLoginModal()">
        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
      </button>
      <button class="btn-register" onclick="window.AuthUI?.showRegisterModal()">
        <i class="fas fa-user-plus"></i> Registrarse
      </button>
    </div>
    <div id="user-menu" class="user-menu" style="display: none;">
      <button id="user-menu-btn" class="user-menu-btn">
        <img src="" alt="" class="user-avatar-sm">
        <span>Usuario</span>
        <i class="fas fa-chevron-down"></i>
      </button>
      <div id="user-dropdown" class="user-dropdown" style="display: none;">
        <a href="./"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        <a href="./perfil.html"><i class="fas fa-user"></i> Mi Perfil</a>
        <a href="./configuracion.html"><i class="fas fa-cog"></i> Configuración</a>
        <hr>
        <button id="logout-btn" class="logout-btn">
          <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
        </button>
      </div>
    </div>
  </header>

  <!-- Contenido del Dashboard -->
  <div class="dashboard-container" id="dashboard-content">
    <aside class="sidebar">
      <div class="user-info">
        <div class="user-avatar" id="user-avatar">GC</div>
        <h3 id="user-name">Usuario</h3>
        <p id="user-tier" style="color: var(--color-secondary);">Miembro Básico</p>
      </div>
      
      <nav class="sidebar-nav">
        <a href="#overview" class="nav-item active" onclick="switchTab('overview')">
          <i class="fas fa-chart-line"></i> Resumen
        </a>
        <a href="#portfolio" class="nav-item" onclick="switchTab('portfolio')">
          <i class="fas fa-wallet"></i> Mi Portafolio
        </a>
        <a href="#academy" class="nav-item" onclick="switchTab('academy')">
          <i class="fas fa-graduation-cap"></i> Academia
        </a>
        <a href="#settings" class="nav-item" onclick="switchTab('settings')">
          <i class="fas fa-cog"></i> Configuración
        </a>
      </nav>
      
      <!-- CoinGecko Widget -->
      <div class="crypto-widget">
        <div class="crypto-widget-header">
          <div class="crypto-widget-title">
            <i class="fas fa-chart-line"></i>
            Precios Cripto
          </div>
          <button class="crypto-refresh-btn" onclick="refreshCryptoPrice()" title="Actualizar precios">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
        <div class="crypto-list" id="crypto-list">
          <div class="crypto-loading">
            <i class="fas fa-spinner"></i>
            <p>Cargando precios...</p>
          </div>
        </div>
      </div>
    </aside>
    
    <main class="main-content">
      <section id="overview" class="content-section active">
        <h2>Resumen de tu Cuenta</h2>
        
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Portafolio Total</h3>
            <div class="stat-value" id="total-portfolio">$0.00</div>
            <p>+0% este mes</p>
          </div>
          
          <div class="stat-card">
            <h3>Inversiones Activas</h3>
            <div class="stat-value" id="active-investments">0</div>
            <p>Proyectos en curso</p>
          </div>
          
          <div class="stat-card">
            <h3>Rendimiento Mensual</h3>
            <div class="stat-value" id="monthly-roi">0%</div>
            <p>Promedio</p>
          </div>
        </div>
        
        <!-- ============================================
             SECCIÓN PROGRESO ACADÉMICO
             ============================================ -->
        <div class="academia-section" id="academia-progress-section">
          <div class="academia-header">
            <h3><i class="fas fa-graduation-cap"></i> Tu Progreso Académico</h3>
            <a href="../academia/" class="view-all-link">
              Ver Academia Completa <i class="fas fa-arrow-right"></i>
            </a>
          </div>
          
          <!-- Stats Académicas -->
          <div class="academia-stats">
            <div class="academia-stat-card">
              <div class="stat-icon">⭐</div>
              <div class="stat-label">Puntos XP</div>
              <div class="stat-number" id="user-xp">0</div>
              <div class="stat-sublabel">Experiencia total</div>
            </div>
            
            <div class="academia-stat-card">
              <div class="stat-icon" id="level-icon">👶</div>
              <div class="stat-label">Nivel Actual</div>
              <div class="stat-number" id="user-level">Novice</div>
              <div class="stat-sublabel">Sigue aprendiendo</div>
            </div>
            
            <div class="academia-stat-card">
              <div class="stat-icon">🔥</div>
              <div class="stat-label">Racha de Estudio</div>
              <div class="stat-number" id="user-streak">0</div>
              <div class="stat-sublabel">días consecutivos</div>
            </div>
            
            <div class="academia-stat-card">
              <div class="stat-icon">📚</div>
              <div class="stat-label">Lecciones</div>
              <div class="stat-number" id="lessons-completed">0/10</div>
              <div class="stat-sublabel">completadas</div>
            </div>
          </div>
          
          <!-- Barra de Progreso XP -->
          <div class="xp-progress-container">
            <div class="xp-progress-header">
              <div class="current-level">
                <span class="level-icon" id="progress-level-icon">👶</span>
                <span id="progress-level-name">Novice</span>
              </div>
              <div class="xp-text">
                <span id="current-xp">0</span> / <span id="next-level-xp">100</span> XP
              </div>
            </div>
            <div class="progress-bar-wrapper">
              <div class="progress-bar-fill" id="xp-progress-bar" style="width: 0%">
                <span id="progress-percentage">0%</span>
              </div>
            </div>
          </div>
          
          <!-- Cursos en Progreso -->
          <div class="courses-progress">
            <h4 style="margin-bottom: 20px; color: var(--text-light);">
              <i class="fas fa-book-open"></i> Cursos en Progreso
            </h4>
            <div class="courses-grid" id="courses-in-progress">
              <!-- Se llenará dinámicamente con JS -->
              <div class="empty-state">
                <div class="empty-state-icon"><i class="fas fa-book-reader"></i></div>
                <h4>Aún no has comenzado ningún curso</h4>
                <p>Explora la <a href="../academia/">Academia YavlGold</a> y comienza tu primera lección</p>
              </div>
            </div>
          </div>
          
          <!-- Próxima Lección Sugerida -->
          <div id="next-lesson-container" style="display: none;">
            <h4 style="margin-bottom: 20px; color: var(--text-light);">
              <i class="fas fa-play-circle"></i> Continúa Tu Aprendizaje
            </h4>
            <div class="next-lesson-card">
              <div class="next-lesson-icon">
                <i class="fas fa-rocket"></i>
              </div>
              <div class="next-lesson-content">
                <div class="next-lesson-label">Próxima lección</div>
                <h4 id="next-lesson-title">¿Qué es Bitcoin?</h4>
                <div class="next-lesson-meta">
                  <span><i class="fas fa-layer-group"></i> Módulo 1</span>
                  <span><i class="fas fa-clock"></i> 15 minutos</span>
                  <span><i class="fas fa-star"></i> +10 XP</span>
                </div>
                <a href="../academia/lecciones/modulo-1/01-que-es-bitcoin.html" class="btn-start-lesson" id="next-lesson-link">
                  Comenzar Ahora <i class="fas fa-arrow-right"></i>
                </a>
              </div>
            </div>
          </div>
          
          <!-- Badges Recientes -->
          <div class="badges-section">
            <h4 style="margin-bottom: 20px; color: var(--text-light);">
              <i class="fas fa-trophy"></i> Logros Recientes
            </h4>
            <div class="badges-grid" id="recent-badges">
              <!-- Se llenará dinámicamente con JS -->
              <div class="empty-state">
                <div class="empty-state-icon"><i class="fas fa-medal"></i></div>
                <h4>Sin logros aún</h4>
                <p>Completa lecciones para desbloquear badges</p>
              </div>
            </div>
          </div>
        </div>
        
        <h3>Herramientas YavlGold</h3>
        <div class="quick-actions">
          <a href="../herramientas/calculadora.html" class="action-card" data-protected="true">
            <div class="action-icon"><i class="fas fa-calculator"></i></div>
            <h4>Calculadora</h4>
            <p>Proyecciones de inversión</p>
          </a>
          
          <a href="../herramientas/conversor.html" class="action-card" data-protected="true">
            <div class="action-icon"><i class="fas fa-exchange-alt"></i></div>
            <h4>Calculadora Cripto</h4>
            <p>Conversión en tiempo real</p>
          </a>
          
          <a href="../herramientas/analisis.html" class="action-card">
            <div class="action-icon"><i class="fas fa-chart-line"></i></div>
            <h4>Análisis de Mercado</h4>
            <p>Tendencias y datos</p>
          </a>
          
          <a href="../#comunidad" class="action-card">
            <div class="action-icon"><i class="fas fa-users"></i></div>
            <h4>Comunidad</h4>
            <p>Conectar con traders</p>
          </a>
        </div>

        <h3>Ecosistema Yavl</h3>
        <div class="quick-actions ecosystem-section">
          <a href="https://yavlgold.com" target="_blank" class="action-card ecosystem-card priority-1">
            <div class="action-icon"><i class="fas fa-coins"></i></div>
            <h4>YavlGold</h4>
            <p>Plataforma principal de trading</p>
            <span class="priority-badge">Alta Prioridad</span>
          </a>
          
          <a href="https://yavlgold.gold" target="_blank" class="action-card ecosystem-card priority-2">
            <div class="action-icon"><i class="fas fa-share-alt"></i></div>
            <h4>YavlSocial</h4>
            <p>Red social del ecosistema</p>
            <span class="priority-badge">Alta Prioridad</span>
          </a>
          
          <a href="/apps/agro/" target="_blank" class="action-card ecosystem-card">
            <div class="action-icon"><i class="fas fa-seedling"></i></div>
            <h4>YavlAgro</h4>
            <p>Agricultura y tecnología</p>
          </a>
          
          <a href="/apps/suite/" target="_blank" class="action-card ecosystem-card">
            <div class="action-icon"><i class="fas fa-briefcase"></i></div>
            <h4>YavlSuite</h4>
            <p>Herramientas empresariales</p>
          </a>
          
          <a href="#" onclick="alert('YavlChess estará disponible próximamente'); return false;" class="action-card ecosystem-card coming-soon">
            <div class="action-icon"><i class="fas fa-chess"></i></div>
            <h4>YavlChess</h4>
            <p>Ajedrez en línea</p>
            <span class="coming-soon-badge">Próximamente</span>
          </a>
        </div>

        <!-- Sección de Anuncios -->
        <div class="announcements-section">
          <div class="announcements-header">
            <h3>
              <i class="fas fa-bullhorn"></i>
              Anuncios y Actualizaciones
            </h3>
            <button id="create-announcement-btn" class="create-announcement-btn" style="display: none;">
              <i class="fas fa-plus"></i> Crear Anuncio
            </button>
          </div>
          
          <div id="announcements-container">
            <div class="loading-spinner">
              <i class="fas fa-spinner fa-spin fa-2x"></i>
              <p>Cargando anuncios...</p>
            </div>
          </div>
        </div>
      </section>
      
      <section id="portfolio" class="content-section">
        <h2>Mi Portafolio</h2>
        <p>Funcionalidad en desarrollo. Próximamente podrás gestionar tu portafolio de inversiones.</p>
      </section>
      
      <section id="academy" class="content-section">
        <h2>Academia</h2>
        
        <!-- Banner Coming Soon -->
        <div style="
          background: linear-gradient(135deg, rgba(200, 167, 82, 0.15), rgba(212, 175, 55, 0.1));
          border: 2px solid var(--color-secondary);
          border-radius: var(--border-radius);
          padding: 40px 30px;
          text-align: center;
          margin-top: 20px;
        ">
          <div style="font-size: 3rem; margin-bottom: 15px; animation: bounce 2s ease-in-out infinite;">🚀</div>
          <h3 style="
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--color-secondary);
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(200, 167, 82, 0.3);
          ">Próximamente: Nueva Academia Interactiva</h3>
          <p style="color: var(--text-muted); font-size: 1.1rem; margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
            Estamos desarrollando una experiencia de aprendizaje revolucionaria, inspirada en Duolingo
          </p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
            <div style="padding: 20px; background: var(--card-bg); border-radius: 10px; border: 1px solid rgba(200, 167, 82, 0.2);">
              <i class="fas fa-video" style="font-size: 2rem; color: var(--color-secondary); margin-bottom: 10px;"></i>
              <h4 style="margin: 10px 0 5px; color: var(--text-light);">Videos Educativos</h4>
              <p style="color: var(--text-muted); font-size: 0.9rem;">Contenido visual de alta calidad</p>
            </div>
            <div style="padding: 20px; background: var(--card-bg); border-radius: 10px; border: 1px solid rgba(200, 167, 82, 0.2);">
              <i class="fas fa-question-circle" style="font-size: 2rem; color: var(--color-secondary); margin-bottom: 10px;"></i>
              <h4 style="margin: 10px 0 5px; color: var(--text-light);">Quizzes Interactivos</h4>
              <p style="color: var(--text-muted); font-size: 0.9rem;">5 preguntas por lección</p>
            </div>
            <div style="padding: 20px; background: var(--card-bg); border-radius: 10px; border: 1px solid rgba(200, 167, 82, 0.2);">
              <i class="fas fa-trophy" style="font-size: 2rem; color: var(--color-secondary); margin-bottom: 10px;"></i>
              <h4 style="margin: 10px 0 5px; color: var(--text-light);">Sistema de Ranking</h4>
              <p style="color: var(--text-muted); font-size: 0.9rem;">Compite y progresa</p>
            </div>
            <div style="padding: 20px; background: var(--card-bg); border-radius: 10px; border: 1px solid rgba(200, 167, 82, 0.2);">
              <i class="fas fa-gamepad" style="font-size: 2rem; color: var(--color-secondary); margin-bottom: 10px;"></i>
              <h4 style="margin: 10px 0 5px; color: var(--text-light);">Duelos Online</h4>
              <p style="color: var(--text-muted); font-size: 0.9rem;">Desafía a otros usuarios</p>
            </div>
          </div>
          
          <a href="../academia/" style="
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 32px;
            background: var(--gradient-gold);
            color: var(--bg-darker);
            text-decoration: none;
            border-radius: 10px;
            font-weight: 700;
            margin-top: 20px;
            transition: var(--transition);
          " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
            <i class="fas fa-graduation-cap"></i> Ver Más Detalles
          </a>
        </div>
      </section>
      
      <section id="settings" class="content-section">
        <h2>Configuración de Cuenta</h2>
        <div style="max-width: 400px;">
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; color: var(--color-secondary);">Nombre</label>
            <input type="text" id="user-name-input" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; color: var(--color-secondary);">Email</label>
            <input type="email" id="user-email" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
          </div>
          
          <button class="btn btn-primary" onclick="updateUserSettings()">Guardar Cambios</button>
        </div>
      </section>
    </main>
  </div>

  <!-- Mensaje cuando no hay sesión -->
  <div class="login-prompt" id="login-prompt" style="display: none;">
    <div style="font-size: 4rem; color: var(--color-secondary); margin-bottom: 20px;">
      <i class="fas fa-lock"></i>
    </div>
    <h2>Acceso Restringido</h2>
  <p>Debes iniciar sesión para acceder al dashboard y disfrutar de todas las herramientas premium de YavlGold.</p>
    <div style="margin-top: 30px;">
      <button class="btn btn-primary" onclick="showAuthModal('login')">Iniciar Sesión</button>
      <a href="../" class="btn btn-secondary">Ir a la Página Principal</a>
    </div>
  </div>

  <!-- Modal para Crear/Editar Anuncio -->
  <div id="announcement-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 99999; overflow-y: auto; padding: 20px;">
    <div class="modal-content" style="max-width: 600px; width: 100%; margin: 50px auto; background: #1a1a1a; border-radius: 12px; padding: 30px; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 2px solid #C8A752;">
      <button class="close-modal-btn" onclick="closeAnnouncementModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #fff; font-size: 28px; cursor: pointer; line-height: 1; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s;">&times;</button>
      
      <h2 id="announcement-modal-title" style="color: #C8A752; margin-bottom: 25px;">
        <i class="fas fa-bullhorn"></i> Crear Anuncio
      </h2>
      
      <form id="announcement-form">
        <input type="hidden" id="announcement-id">
        
        <div class="form-group" style="margin-bottom: 20px;">
          <label for="announcement-title" style="display: block; margin-bottom: 8px; color: #E5E5E5; font-weight: 500;">
            Título <span style="color: #f44336;">*</span>
          </label>
          <input 
            type="text" 
            id="announcement-title" 
            required 
            maxlength="200"
            placeholder="Ej: Nueva funcionalidad disponible"
            style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #0B0C0F; color: #E5E5E5; font-size: 1rem;"
          >
          <small style="color: #888; font-size: 0.85rem;">Máximo 200 caracteres</small>
        </div>
        
        <div class="form-group" style="margin-bottom: 25px;">
          <label for="announcement-content" style="display: block; margin-bottom: 8px; color: #E5E5E5; font-weight: 500;">
            Contenido <span style="color: #f44336;">*</span>
          </label>
          <textarea 
            id="announcement-content" 
            required 
            maxlength="2000"
            rows="8"
            placeholder="Escribe el contenido del anuncio aquí..."
            style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #0B0C0F; color: #E5E5E5; font-size: 1rem; resize: vertical; font-family: inherit;"
          ></textarea>
          <small style="color: #888; font-size: 0.85rem;">Máximo 2000 caracteres</small>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button 
            type="button" 
            onclick="closeAnnouncementModal()" 
            style="padding: 12px 24px; border-radius: 8px; border: 1px solid #333; background: transparent; color: #E5E5E5; cursor: pointer; font-size: 1rem;"
          >
            Cancelar
          </button>
          <button 
            type="submit" 
            id="announcement-submit-btn"
            style="padding: 12px 24px; border-radius: 8px; border: none; background: linear-gradient(135deg, #C8A752 0%, #8B7842 100%); color: #0B0C0F; cursor: pointer; font-weight: bold; font-size: 1rem;"
          >
            <i class="fas fa-paper-plane"></i> Publicar
          </button>
        </div>
      </form>
      
      <div id="announcement-form-message" style="margin-top: 20px; padding: 12px; border-radius: 8px; display: none;"></div>
    </div>
  </div>

  <!-- Modal de Autenticación -->
  <div id="modal-overlay"></div>
  <div class="modal" id="auth-modal">
    <button class="close-modal-btn" onclick="closeAuthModal()">&times;</button>
    
    <div class="modal-header">
  <img src="/assets/images/logo.png" alt="YavlGold Logo" class="modal-logo">
      <h2 id="modal-title">Bienvenido</h2>
    </div>
    
    <div class="auth-tabs">
      <div class="auth-tab active" id="login-tab" onclick="switchAuthTab('login')">Iniciar Sesión</div>
      <div class="auth-tab" id="register-tab" onclick="switchAuthTab('register')">Registrarse</div>
    </div>
    
    <!-- Formulario de Login -->
    <form class="auth-form active" id="login-form">
      <div class="form-group">
        <label for="username">Usuario</label>
        <input type="text" id="username" name="username" required>
      </div>
      <div class="form-group">
        <label for="password">Contraseña</label>
        <div class="password-container">
          <input type="password" id="password" name="password" required>
          <button type="button" class="toggle-password" onclick="togglePassword('password')"><i class="fas fa-eye"></i></button>
        </div>
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%;">Entrar</button>
    </form>
    
    <!-- Formulario de Registro -->
    <form class="auth-form" id="register-form">
      <div class="form-group">
        <label for="register-name">Nombre</label>
        <input type="text" id="register-name" required>
      </div>
      <div class="form-group">
        <label for="register-email">Email</label>
        <input type="email" id="register-email" required>
      </div>
      <div class="form-group">
        <label for="register-password">Contraseña</label>
        <div class="password-container">
          <input type="password" id="register-password" required>
          <button type="button" class="toggle-password" onclick="togglePasswordVisibility('register-password')"><i class="fas fa-eye"></i></button>
        </div>
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%;">Crear Cuenta</button>
    </form>
  </div>

  <!-- Footer unificado -->
  <footer>
    <div class="footer-brand">
      <img src="/assets/images/logo.png" alt="YavlGold" class="footer-logo">
      <span>YavlGold</span>
    </div>
    <p>Ecosistema Global Innovador en Cripto</p>
    <div class="footer-links">
      <a href="../herramientas/">Herramientas</a>
      <a href="../academia/">Academia</a>
      <a href="../#comunidad">Comunidad</a>
      <a href="./">Dashboard</a>
      <a href="../#contacto">Contacto</a>
    </div>
    <div class="copyright">
  <p>YavlGold &copy; 2025 - Creado por Yerikson Varela (YAVL Pro)</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="../assets/js/themeManager.js"></script>
  <script src="../assets/js/auth/authClient.js"></script>
  <script src="../assets/js/auth/authUI.js"></script>
  <script src="../assets/js/auth/authGuard.js"></script>
  <script src="../assets/js/auth/trueProtect.js"></script> <!-- 🔒 TrueProtect: Protección avanzada -->
  <script src="../assets/js/profile/profileManager.js"></script>
  <script src="../assets/js/announcements/announcementsManager.js"></script>
  <script src="../assets/js/academia.js"></script> <!-- Sistema de progreso académico -->
  
  <script>
    // Inicializar el botón de cambio de tema
    document.addEventListener('DOMContentLoaded', function() {
      if (window.ThemeManager) {
        ThemeManager.setupToggleButton('theme-toggle');
      }
      
      // ========================================
      // USER MENU DROPDOWN TOGGLE
      // ========================================
      const userMenuBtn = document.getElementById('user-menu-btn');
      const userDropdown = document.getElementById('user-dropdown');
      
      if (userMenuBtn && userDropdown) {
        // Toggle dropdown cuando se hace clic en el botón
        userMenuBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          const isVisible = userDropdown.style.display === 'block';
          userDropdown.style.display = isVisible ? 'none' : 'block';
        });
        
        // Cerrar dropdown cuando se hace clic fuera
        document.addEventListener('click', function(e) {
          if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
            userDropdown.style.display = 'none';
          }
        });
      }
      
      // ========================================
      // LOGOUT BUTTON FUNCTIONALITY
      // ========================================
      const logoutBtn = document.getElementById('logout-btn');
      
      if (logoutBtn) {
        logoutBtn.addEventListener('click', async function(e) {
          e.preventDefault();
          
          try {
            // Cerrar sesión con Supabase si está disponible
            if (window.supabase && window.supabase.auth) {
              const { error } = await window.supabase.auth.signOut();
              if (error) {
                console.error('Error al cerrar sesión:', error);
              }
            }
            
            // Limpiar localStorage
            localStorage.removeItem('sb-pxdhllmmgtxqrtfcltbx-auth-token');
            localStorage.removeItem('user-session');
            localStorage.removeItem('user-data');
            
            // Mostrar mensaje de éxito
            showNotification('Sesión cerrada correctamente', 'success');
            
            // Redirigir al inicio después de 1 segundo
            setTimeout(() => {
              window.location.href = '../#login';
            }, 1000);
            
          } catch (error) {
            console.error('Error al cerrar sesión:', error);
            showNotification('Error al cerrar sesión', 'error');
          }
        });
      }
    });
  </script>
  
  <script>
    // Función para cambiar de pestaña en el dashboard
    function switchTab(tabId) {
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(tabId).classList.add('active');
      
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      const tabLink = document.querySelector(`a[href="#${tabId}"]`);
      if (tabLink) tabLink.classList.add('active');
    }

    // Función para actualizar configuración del usuario
    function updateUserSettings() {
      // Implementar con Supabase
      showNotification('Configuración guardada correctamente', 'success');
    }

    // Modal control functions
    function showAuthModal(tab) {
      const overlay = document.getElementById('modal-overlay');
      const modal = document.getElementById('auth-modal');
      if (overlay && modal) {
        overlay.style.display = 'block';
        modal.style.display = 'block';
        if (tab) {
          setAuthTab(tab);
        }
      }
    }
    
    function hideAuthModal() {
      const overlay = document.getElementById('modal-overlay');
      const modal = document.getElementById('auth-modal');
      if (overlay && modal) {
        overlay.style.display = 'none';
        modal.style.display = 'none';
      }
    }
    
    function closeAuthModal() {
      hideAuthModal();
    }
    
    function setAuthTab(tab) {
      const loginTab = document.getElementById('login-tab');
      const registerTab = document.getElementById('register-tab');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const modalTitle = document.getElementById('modal-title');
      
      if (tab === 'login') {
        loginTab?.classList.add('active');
        registerTab?.classList.remove('active');
        loginForm?.classList.add('active');
        registerForm?.classList.remove('active');
        if (modalTitle) modalTitle.textContent = 'Iniciar Sesión';
      } else if (tab === 'register') {
        loginTab?.classList.remove('active');
        registerTab?.classList.add('active');
        loginForm?.classList.remove('active');
        registerForm?.classList.add('active');
        if (modalTitle) modalTitle.textContent = 'Registrarse';
      }
    }
    
    function switchAuthTab(tab) {
      setAuthTab(tab);
    }
    
    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      const icon = input?.parentElement?.querySelector('.toggle-password i');
      if (input) {
        if (input.type === 'password') {
          input.type = 'text';
          if (icon) icon.className = 'fas fa-eye-slash';
        } else {
          input.type = 'password';
          if (icon) icon.className = 'fas fa-eye';
        }
      }
    }
    
    function togglePasswordVisibility(inputId) {
      togglePassword(inputId);
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
        <span>${message}</span>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    // Close modal when clicking overlay
    document.getElementById('modal-overlay')?.addEventListener('click', hideAuthModal);

    // ========================================
    // ANNOUNCEMENTS FUNCTIONALITY
    // ========================================
    
    let currentAnnouncementsPage = 0;
    const announcementsPerPage = 5;
    let isAdmin = false;

    async function loadAnnouncements(append = false) {
      const container = document.getElementById('announcements-container');
      if (!container) return;

      if (!append) {
        container.innerHTML = `
          <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin fa-2x"></i>
            <p>Cargando anuncios...</p>
          </div>
        `;
      }

      try {
        // FORZAR REFRESH - nunca usar caché
        const result = await AnnouncementsManager.getAnnouncements({
          limit: announcementsPerPage,
          offset: currentAnnouncementsPage * announcementsPerPage,
          forceRefresh: true  // ← ESTO FUERZA CONSULTA FRESCA
        });

        if (result.success) {
          if (result.announcements.length === 0 && currentAnnouncementsPage === 0) {
            container.innerHTML = `
              <div class="no-announcements">
                <i class="fas fa-inbox fa-3x" style="margin-bottom: 15px; opacity: 0.3;"></i>
                <p>No hay anuncios disponibles en este momento</p>
              </div>
            `;
            return;
          }

          const announcementsHTML = result.announcements.map(announcement => {
            const date = new Date(announcement.created_at);
            const formattedDate = date.toLocaleDateString('es-ES', { 
              year: 'numeric', 
              month: 'short', 
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });

            const authorName = announcement.author?.username || 'Administrador';
            const authorAvatar = announcement.author?.avatar_url || 'https://ui-avatars.com/api/?name=Admin&background=C8A752&color=0B0C0F&bold=true';

            const isEdited = announcement.updated_at && announcement.updated_at !== announcement.created_at;

            return `
              <div class="announcement-card" data-id="${announcement.id}">
                ${isAdmin ? `
                  <div class="announcement-actions">
                    <button class="announcement-btn" onclick="editAnnouncement('${announcement.id}')" title="Editar">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="announcement-btn" onclick="deleteAnnouncement('${announcement.id}')" title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                ` : ''}
                
                <div class="announcement-header">
                  <div>
                    <h4 class="announcement-title">${escapeHtml(announcement.title)}</h4>
                    <div class="announcement-meta">
                      <div class="announcement-author">
                        <img src="${authorAvatar}" alt="${authorName}" class="announcement-author-avatar">
                        <span>${authorName}</span>
                        <span class="admin-badge">ADMIN</span>
                      </div>
                      <div class="announcement-date">
                        <i class="fas fa-clock"></i>
                        <span>${formattedDate}</span>
                        ${isEdited ? '<span style="font-style: italic;">(editado)</span>' : ''}
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="announcement-content">${escapeHtml(announcement.content)}</div>
              </div>
            `;
          }).join('');

          if (append) {
            const loadMoreBtn = container.querySelector('.load-more-btn');
            if (loadMoreBtn) loadMoreBtn.remove();
            container.insertAdjacentHTML('beforeend', announcementsHTML);
          } else {
            container.innerHTML = announcementsHTML;
          }

          // Agregar botón "Cargar más" si hay más anuncios
          if (result.announcements.length === announcementsPerPage) {
            container.insertAdjacentHTML('beforeend', `
              <button class="load-more-btn" onclick="loadMoreAnnouncements()">
                <i class="fas fa-chevron-down"></i> Cargar más anuncios
              </button>
            `);
          }
        } else {
          throw new Error(result.error || 'Error al cargar anuncios');
        }
      } catch (error) {
        console.error('Error loading announcements:', error);
        container.innerHTML = `
          <div class="no-announcements">
            <i class="fas fa-exclamation-circle fa-3x" style="margin-bottom: 15px; color: #ff6b6b;"></i>
            <p>Error al cargar los anuncios</p>
            <button onclick="loadAnnouncements()" style="margin-top: 15px; padding: 10px 20px; background: var(--color-secondary); border: none; border-radius: 6px; cursor: pointer;">
              Reintentar
            </button>
          </div>
        `;
      }
    }

    async function loadMoreAnnouncements() {
      currentAnnouncementsPage++;
      await loadAnnouncements(true);
    }

    async function checkAdminStatus() {
      const session = AuthClient.getSession();
      if (!session?.user?.id) {
        isAdmin = false;
        return;
      }

      const result = await ProfileManager.isAdmin(session.user.id);
      isAdmin = result.success && result.isAdmin;

      // Mostrar/ocultar botón de crear anuncio
      const createBtn = document.getElementById('create-announcement-btn');
      if (createBtn) {
        createBtn.style.display = isAdmin ? 'inline-block' : 'none';
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ========================================
    // FUNCIONES PARA MODAL DE ANUNCIOS
    // ========================================
    
    function openAnnouncementModal(announcementId = null, title = '', content = '') {
      const modal = document.getElementById('announcement-modal');
      const modalTitle = document.getElementById('announcement-modal-title');
      const form = document.getElementById('announcement-form');
      const idInput = document.getElementById('announcement-id');
      const titleInput = document.getElementById('announcement-title');
      const contentInput = document.getElementById('announcement-content');
      const submitBtn = document.getElementById('announcement-submit-btn');
      
      // Resetear formulario
      form.reset();
      document.getElementById('announcement-form-message').style.display = 'none';
      
      if (announcementId) {
        // Modo edición
        modalTitle.innerHTML = '<i class="fas fa-edit"></i> Editar Anuncio';
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Guardar Cambios';
        idInput.value = announcementId;
        titleInput.value = title;
        contentInput.value = content;
      } else {
        // Modo creación
        modalTitle.innerHTML = '<i class="fas fa-bullhorn"></i> Crear Anuncio';
        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Publicar';
        idInput.value = '';
      }
      
      // Mostrar modal
      modal.style.display = 'block';
      
      // Focus en el título
      setTimeout(() => titleInput.focus(), 100);
    }
    
    function closeAnnouncementModal() {
      const modal = document.getElementById('announcement-modal');
      modal.style.display = 'none';
    }
    
    // Cerrar modal al hacer click fuera
    document.getElementById('announcement-modal')?.addEventListener('click', function(e) {
      if (e.target === this) {
        closeAnnouncementModal();
      }
    });
    
    // Manejar envío del formulario
    document.getElementById('announcement-form')?.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const messageDiv = document.getElementById('announcement-form-message');
      const submitBtn = document.getElementById('announcement-submit-btn');
      const announcementId = document.getElementById('announcement-id').value;
      const title = document.getElementById('announcement-title').value.trim();
      const content = document.getElementById('announcement-content').value.trim();
      
      if (!title || !content) {
        messageDiv.style.display = 'block';
        messageDiv.style.background = '#f44336';
        messageDiv.style.color = '#fff';
        messageDiv.textContent = 'Por favor completa todos los campos';
        return;
      }
      
      // Deshabilitar botón
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
      
      try {
        let result;
        
        if (announcementId) {
          // Actualizar
          result = await AnnouncementsManager.updateAnnouncement(announcementId, { title, content });
        } else {
          // Crear
          result = await AnnouncementsManager.createAnnouncement(title, content);
        }
        
        if (result.success) {
          messageDiv.style.display = 'block';
          messageDiv.style.background = '#4CAF50';
          messageDiv.style.color = '#fff';
          messageDiv.textContent = announcementId ? '✅ Anuncio actualizado exitosamente' : '✅ Anuncio creado exitosamente';
          
          // Recargar anuncios
          currentAnnouncementsPage = 0;
          await loadAnnouncements();
          
          // Cerrar modal después de 1.5 segundos
          setTimeout(() => {
            closeAnnouncementModal();
          }, 1500);
        } else {
          throw new Error(result.error || 'Error desconocido');
        }
      } catch (error) {
        messageDiv.style.display = 'block';
        messageDiv.style.background = '#f44336';
        messageDiv.style.color = '#fff';
        messageDiv.textContent = '❌ ' + error.message;
        
        // Rehabilitar botón
        submitBtn.disabled = false;
        submitBtn.innerHTML = announcementId ? '<i class="fas fa-save"></i> Guardar Cambios' : '<i class="fas fa-paper-plane"></i> Publicar';
      }
    });

    async function createAnnouncement() {
      openAnnouncementModal();
    }

    async function editAnnouncement(id) {
      // Obtener el anuncio actual
      const result = await AnnouncementsManager.getAnnouncement(id);
      
      if (result.success) {
        const announcement = result.announcement;
        openAnnouncementModal(id, announcement.title, announcement.content);
      } else {
        showNotification('Error al obtener anuncio', 'error');
      }
    }

    async function deleteAnnouncement(id) {
      if (!confirm('¿Estás seguro de eliminar este anuncio?\n\nEsta acción no se puede deshacer.')) return;

      try {
        console.log('[Dashboard] 🗑️ Eliminando anuncio:', id);
        
        // Limpiar caché antes de eliminar
        AnnouncementsManager.clearCache();
        
        const result = await AnnouncementsManager.deleteAnnouncement(id);
        
        if (result.success) {
          showNotification('✅ Anuncio eliminado exitosamente', 'success');
          
          // Limpiar caché después de eliminar
          AnnouncementsManager.clearCache();
          
          // Resetear página y recargar
          currentAnnouncementsPage = 0;
          allAnnouncementsLoaded = false;
          
          // Esperar un momento y recargar CON FORCE REFRESH
          await new Promise(resolve => setTimeout(resolve, 500)); // Aumentado a 500ms
          await loadAnnouncements(); // Ya tiene forceRefresh: true
          
          console.log('[Dashboard] ✅ Anuncios recargados después de eliminar');
        } else {
          console.error('[Dashboard] ❌ Error al eliminar:', result.error);
          showNotification('❌ ' + (result.error || 'Error al eliminar anuncio'), 'error');
        }
      } catch (error) {
        console.error('[Dashboard] ❌ Excepción al eliminar:', error);
        showNotification('❌ Error: ' + error.message, 'error');
      }
    }

    // Event listener para botón de crear anuncio
    document.getElementById('create-announcement-btn')?.addEventListener('click', createAnnouncement);

    document.addEventListener('DOMContentLoaded', function() {
      // Activar la primera pestaña por defecto
      switchTab('overview');
      
      // Cargar anuncios y verificar admin status
      setTimeout(async () => {
        await checkAdminStatus();
        await loadAnnouncements();
      }, 500);
      
      // Cargar progreso académico
      setTimeout(async () => {
        await loadAcademiaProgress();
      }, 800);
    });
    
    /**
     * Cargar y mostrar progreso académico del usuario
     */
    async function loadAcademiaProgress() {
      try {
        // Verificar que academia.js esté cargado
        if (!window.academiaProgress) {
          console.log('[Dashboard] ⏳ Academia.js aún no cargado, reintentando...');
          setTimeout(loadAcademiaProgress, 500);
          return;
        }
        
        // Esperar a que el usuario esté autenticado
        const { data: { user } } = await window.supabase.auth.getUser();
        if (!user) {
          console.log('[Dashboard] 👤 Usuario no autenticado');
          return;
        }
        
        console.log('[Dashboard] 📊 Cargando progreso académico...');
        
        // Obtener stats del usuario
        const stats = await window.academiaProgress.getProgressStats();
        
        if (!stats) {
          console.log('[Dashboard] ⚠️ No se pudieron cargar las stats');
          return;
        }
        
        console.log('[Dashboard] ✅ Stats cargadas:', stats);
        
        // Actualizar stats cards
        document.getElementById('user-xp').textContent = stats.xp || 0;
        document.getElementById('user-level').textContent = stats.level || 'Novice';
        document.getElementById('user-streak').textContent = stats.streak || 0;
        document.getElementById('lessons-completed').textContent = 
          `${stats.lessonsCompleted || 0}/${stats.totalLessons || 10}`;
        
        // Actualizar icono de nivel
        const levelIcons = {
          'Novice': '👶',
          'Adept': '🎓',
          'Expert': '🏆',
          'Master': '👑'
        };
        const levelIcon = levelIcons[stats.level] || '👶';
        document.getElementById('level-icon').textContent = levelIcon;
        document.getElementById('progress-level-icon').textContent = levelIcon;
        document.getElementById('progress-level-name').textContent = stats.level || 'Novice';
        
        // Calcular progreso XP hasta siguiente nivel
        const levelThresholds = {
          'Novice': { min: 0, max: 100 },
          'Adept': { min: 100, max: 500 },
          'Expert': { min: 500, max: 1000 },
          'Master': { min: 1000, max: Infinity }
        };
        
        const currentLevel = levelThresholds[stats.level] || levelThresholds['Novice'];
        const xpInLevel = (stats.xp || 0) - currentLevel.min;
        const xpNeeded = currentLevel.max === Infinity ? 1000 : currentLevel.max - currentLevel.min;
        const progressPercentage = Math.min(Math.round((xpInLevel / xpNeeded) * 100), 100);
        
        document.getElementById('current-xp').textContent = stats.xp || 0;
        document.getElementById('next-level-xp').textContent = 
          currentLevel.max === Infinity ? '∞' : currentLevel.max;
        document.getElementById('xp-progress-bar').style.width = `${progressPercentage}%`;
        document.getElementById('progress-percentage').textContent = `${progressPercentage}%`;
        
        // Cargar cursos en progreso
        await loadCoursesInProgress();
        
        // Cargar badges recientes
        await loadRecentBadges();
        
        // Mostrar próxima lección si hay cursos en progreso
        if (stats.lessonsCompleted < stats.totalLessons) {
          showNextLesson();
        }
        
      } catch (error) {
        console.error('[Dashboard] ❌ Error al cargar progreso académico:', error);
      }
    }
    
    /**
     * Cargar cursos en progreso
     */
    async function loadCoursesInProgress() {
      try {
        const { data: progress, error } = await window.supabase
          .from('user_lesson_progress')
          .select(`
            *,
            lesson:lessons(
              id,
              title,
              lesson_number,
              duration_minutes,
              xp_reward,
              module:modules(
                id,
                title,
                module_number
              )
            )
          `)
          .eq('user_id', (await window.supabase.auth.getUser()).data.user.id)
          .eq('status', 'in_progress')
          .limit(3);
        
        if (error) throw error;
        
        const container = document.getElementById('courses-in-progress');
        
        if (!progress || progress.length === 0) {
          // Mostrar empty state
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon"><i class="fas fa-book-reader"></i></div>
              <h4>Aún no has comenzado ningún curso</h4>
              <p>Explora la <a href="../academia/">Academia YavlGold</a> y comienza tu primera lección</p>
            </div>
          `;
          return;
        }
        
        // Renderizar cursos
        container.innerHTML = progress.map(item => `
          <div class="course-card" onclick="window.location.href='/academia/lecciones/modulo-${item.lesson.module.module_number}/0${item.lesson.lesson_number}-*.html'">
            <div class="course-header">
              <div class="course-icon">📘</div>
              <div class="course-info">
                <h4>${item.lesson.title}</h4>
                <div class="course-meta">
                  <span><i class="fas fa-layer-group"></i> ${item.lesson.module.title}</span>
                  <span><i class="fas fa-clock"></i> ${item.lesson.duration_minutes || 15} min</span>
                </div>
              </div>
            </div>
            <div class="course-progress-bar">
              <div class="course-progress-fill" style="width: ${item.progress_percentage || 0}%"></div>
            </div>
            <div class="course-progress-text">
              <span>${item.progress_percentage || 0}% completado</span>
              <span><i class="fas fa-star"></i> ${item.lesson.xp_reward || 10} XP</span>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('[Dashboard] ❌ Error al cargar cursos:', error);
      }
    }
    
    /**
     * Cargar badges recientes
     */
    async function loadRecentBadges() {
      try {
        const { data: userBadges, error } = await window.supabase
          .from('user_badges')
          .select(`
            *,
            badge:badges(
              id,
              title,
              description,
              rarity,
              xp_reward,
              icon_url
            )
          `)
          .eq('user_id', (await window.supabase.auth.getUser()).data.user.id)
          .order('earned_at', { ascending: false })
          .limit(4);
        
        if (error) throw error;
        
        const container = document.getElementById('recent-badges');
        
        if (!userBadges || userBadges.length === 0) {
          // Mostrar empty state
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon"><i class="fas fa-medal"></i></div>
              <h4>Sin logros aún</h4>
              <p>Completa lecciones para desbloquear badges</p>
            </div>
          `;
          return;
        }
        
        // Renderizar badges
        const badgeIcons = {
          'primer_curso': '🎯',
          'racha_7_dias': '🔥',
          'quiz_perfecto': '🧠',
          'quiz_perfecto_5': '🌟',
          'modulo_completo': '🏅',
          'early_adopter': '🚀'
        };
        
        container.innerHTML = userBadges.map((item, index) => `
          <div class="badge-card ${index === 0 ? 'new-badge' : ''}">
            <div class="badge-icon">${badgeIcons[item.badge.id] || '🏆'}</div>
            <div class="badge-rarity ${item.badge.rarity}">${item.badge.rarity}</div>
            <h5>${item.badge.title}</h5>
            <p>${item.badge.description}</p>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('[Dashboard] ❌ Error al cargar badges:', error);
      }
    }
    
    /**
     * Mostrar próxima lección sugerida
     */
    function showNextLesson() {
      const container = document.getElementById('next-lesson-container');
      if (container) {
        container.style.display = 'block';
      }
    }
    
    /**
     * ===================================================
     * COINGECKO WIDGET - Precios Cripto en Tiempo Real
     * ===================================================
     */
    
    const COINGECKO_API = 'https://api.coingecko.com/api/v3';
    const TOP_CRYPTOS = ['bitcoin', 'ethereum', 'binancecoin', 'ripple', 'cardano', 'solana', 'polkadot', 'dogecoin', 'avalanche-2', 'chainlink'];
    let cryptoRefreshInterval;
    
    /**
     * Fetch crypto prices from CoinGecko API
     */
    async function fetchCryptoPrices() {
      try {
        const ids = TOP_CRYPTOS.join(',');
        const response = await fetch(`${COINGECKO_API}/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`);
        
        if (!response.ok) throw new Error('CoinGecko API error');
        
        const data = await response.json();
        
        // Get logos
        const logosResponse = await fetch(`${COINGECKO_API}/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&per_page=10&page=1`);
        const logosData = await logosResponse.json();
        
        return TOP_CRYPTOS.map(id => {
          const priceData = data[id];
          const logoData = logosData.find(c => c.id === id);
          
          return {
            id,
            name: logoData?.name || id,
            symbol: logoData?.symbol || id,
            price: priceData?.usd || 0,
            change24h: priceData?.usd_24h_change || 0,
            logo: logoData?.image || ''
          };
        });
        
      } catch (error) {
        console.error('❌ Error fetching crypto prices:', error);
        return [];
      }
    }
    
    /**
     * Render crypto prices in the widget
     */
    function renderCryptoPrices(cryptos) {
      const container = document.getElementById('crypto-list');
      
      if (!cryptos || cryptos.length === 0) {
        container.innerHTML = `
          <div class="crypto-loading">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Error al cargar precios</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = cryptos.map(crypto => {
        const changeClass = crypto.change24h >= 0 ? 'positive' : 'negative';
        const changeIcon = crypto.change24h >= 0 ? '▲' : '▼';
        const formattedPrice = crypto.price.toLocaleString('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 2,
          maximumFractionDigits: crypto.price < 1 ? 6 : 2
        });
        const formattedChange = Math.abs(crypto.change24h).toFixed(2);
        
        return `
          <div class="crypto-item">
            <div class="crypto-info">
              ${crypto.logo ? `<img src="${crypto.logo}" alt="${crypto.name}" class="crypto-logo">` : ''}
              <div>
                <div class="crypto-name">${crypto.name}</div>
                <div class="crypto-symbol">${crypto.symbol}</div>
              </div>
            </div>
            <div>
              <div class="crypto-price">${formattedPrice}</div>
              <div class="crypto-change ${changeClass}">
                ${changeIcon} ${formattedChange}%
              </div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    /**
     * Initialize crypto widget
     */
    async function initCryptoWidget() {
      const cryptos = await fetchCryptoPrices();
      renderCryptoPrices(cryptos);
      
      // Auto-refresh every 30 seconds
      if (cryptoRefreshInterval) {
        clearInterval(cryptoRefreshInterval);
      }
      
      cryptoRefreshInterval = setInterval(async () => {
        const updatedCryptos = await fetchCryptoPrices();
        renderCryptoPrices(updatedCryptos);
      }, 30000); // 30 segundos
    }
    
    /**
     * Manual refresh button
     */
    async function refreshCryptoPrice() {
      const container = document.getElementById('crypto-list');
      container.innerHTML = `
        <div class="crypto-loading">
          <i class="fas fa-spinner"></i>
          <p>Actualizando...</p>
        </div>
      `;
      
      await initCryptoWidget();
    }
    
    // Initialize crypto widget on page load
    window.addEventListener('load', () => {
      initCryptoWidget();
    });
    
    // Cleanup interval on page unload
    window.addEventListener('beforeunload', () => {
      if (cryptoRefreshInterval) {
        clearInterval(cryptoRefreshInterval);
      }
    });
  </script>
</body>
</html>